#!/bin/bash
set -e
# Description: Sum up bandwidth usage.
# Return: interface|dateTime|receiveBytes|transmittedBytes
#   Doc: cat /proc/net/dev
#  Note: from ../inst-min-con-cld-tools/cld/bin

# Error handling.
if [ $# -lt 1 ]; then
  echo "Error: List of log files generated by if-usage.sh are required. Aborted!"
  echo "  e.g.: $0 if-usage_2015-01-10.12.59.14.log if-usage_2016-01-10.12.59.14.log"
  exit 1;
fi

CONTENT=$(cat "$@" | grep -v '^lo|')
BYTES_RECEIVED=$(echo "${CONTENT}" | cut -d'|' -f3)
BYTES_TRANSMITTED=$(echo "${CONTENT}" | cut -d'|' -f4)
TOTAL_BYTES_RECEIVED=$(awk '{sum+=$1} END {printf "%.0f", sum}' <(echo "${BYTES_RECEIVED}"))
TOTAL_BYTES_TRANSMITTED=$(awk '{sum+=$1} END {printf "%.0f", sum}' <(echo "${BYTES_TRANSMITTED}"))
TOTAL_RECEIVED_STR=$(numfmt --to=iec-i --suffix=B --format="%7f" "${TOTAL_BYTES_RECEIVED}")
TOTAL_TRANSMITTED_STR=$(numfmt --to=iec-i --suffix=B --format="%7f" "${TOTAL_BYTES_TRANSMITTED}")

echo "${CONTENT}"
echo ""
printf "%20s: %7s \n" "Total downloaded" "${TOTAL_RECEIVED_STR}"
printf "%20s: %7s\n"  "Total uploaded"   "${TOTAL_TRANSMITTED_STR}"
echo ""
